name: RDP Builder

on:
  workflow_dispatch:
    inputs:
      rdp_id:
        description: "ID cho workflow này (do bot gửi)"
        required: true

jobs:
  build_rdp:
    runs-on: ubuntu-latest

    steps:
      - name: 🧩 Bước 1 — Thiết lập môi trường
        run: |
          echo "Workflow ID: ${{ github.event.inputs.rdp_id }}"
          mkdir -p rdp

      - name: ⚙️ Bước 2 — Cài đặt hoặc mô phỏng tạo RDP
        run: |
          echo "Bắt đầu tạo RDP cho ID ${{ github.event.inputs.rdp_id }}"
          # ---- Nếu bạn có script thật thì gọi ở đây, ví dụ ----
          # python scripts/create_rdp.py --id "${{ github.event.inputs.rdp_id }}"
          #
          # Hoặc nếu đang test thì giả lập:
          echo "192.168.${{ github.event.inputs.rdp_id }}.10" > ipv4.txt
          echo "fe80::${{ github.event.inputs.rdp_id }}" > ipv6.txt
          echo "user_${{ github.event.inputs.rdp_id }}" > user.txt
          echo "pass_${{ github.event.inputs.rdp_id }}" > pass.txt

      - name: 📦 Bước 3 — Gộp output JSON để bot dễ đọc
        run: |
          echo "{\"ipv4\": \"$(cat ipv4.txt)\", \"ipv6\": \"$(cat ipv6.txt)\", \"username\": \"$(cat user.txt)\", \"password\": \"$(cat pass.txt)\"}" > rdp/rdp_output.json
          cat rdp/rdp_output.json

      - name: 🚀 Bước 4 — Upload artifact để bot đọc
        uses: actions/upload-artifact@v4
        with:
          name: rdp_output
          path: rdp/rdp_output.json
          retention-days: 1
