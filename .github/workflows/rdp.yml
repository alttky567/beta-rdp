name: RDP Builder

on:
  workflow_dispatch:
    inputs:
      run_id:
        description: "Run ID do bot gửi lên"
        required: true

jobs:
  build_rdp:
    runs-on: ubuntu-latest

    steps:
      - name: 🧩 Bước 1 — Thiết lập môi trường
        run: |
          echo "Workflow run ID: ${{ github.event.inputs.run_id }}"
          mkdir -p rdp

      - name: ⚙️ Bước 2 — Tạo hoặc mô phỏng RDP
        run: |
          echo "Đang tạo RDP cho ID ${{ github.event.inputs.run_id }}..."
          # --- Nếu bạn có script thật, gọi tại đây ---
          # python scripts/create_rdp.py --id "${{ github.event.inputs.run_id }}"
          #
          # --- Nếu đang test, mô phỏng dữ liệu ---
          echo "192.168.${{ github.event.inputs.run_id }}.10" > ipv4.txt
          echo "fe80::${{ github.event.inputs.run_id }}" > ipv6.txt
          echo "rdpuser" > user.txt
          echo "rdppass123" > pass.txt

      - name: 📦 Bước 3 — Tạo file JSON output
        run: |
          echo "{\"ipv4\": \"$(cat ipv4.txt)\", \"ipv6\": \"$(cat ipv6.txt)\", \"username\": \"$(cat user.txt)\", \"password\": \"$(cat pass.txt)\"}" > rdp/rdp_output.json
          cat rdp/rdp_output.json

      - name: 🚀 Bước 4 — Upload artifact cho bot đọc
        uses: actions/upload-artifact@v4
        with:
          name: rdp_output
          path: rdp/rdp_output.json
          retention-days: 1